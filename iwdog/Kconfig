# Copyright (c) 2025 Ovyl
# SPDX-License-Identifier: Apache-2.0

menu "Zmod Internal Watchdog"

config ZMOD_IWDOG
    bool "Internal Watchdog Support"
    default n
    select WATCHDOG

config ZMOD_WATCHDOG_FEED_INTERVAL_MS
    int "Watchdog feed interval (ms)"
    range 50 60000
    default 1000
    depends on ZMOD_IWDOG
    help
      Interval in milliseconds at which the watchdog is fed.
      Must be smaller than the actual watchdog timeout.

config ZMOD_WATCHDOG_TIMEOUT_MS
    int "Watchdog timeout (ms)"
    range 100 120000
    default 5000
    depends on ZMOD_IWDOG
    help
      Timeout in milliseconds for the watchdog. If not fed, system resets.

config ZMOD_IWDOG_THREAD_STACK_SIZE
    int "Zmod IWDOG thread stack size"
    default 1024
    range 256 8192
    depends on ZMOD_IWDOG
    help
      Stack size in bytes for the IWDOG service thread.

config ZMOD_IWDOG_THREAD_PRIORITY
    int "Zmod IWDOG thread priority"
    default 0
    range -16 15
    depends on ZMOD_IWDOG
    help
      Thread priority for the IWDOG service thread.
      Lower values = higher priority.


config ZMOD_IWDOG_WARNING_PCT
    int "Warn when this percent of timeout has elapsed"
    default 75
    range 1 99
    depends on ZMOD_IWDOG
    help
      Example: 75 means warn at 75% of the timeout (25% remaining).

config ZMOD_IWDOG_AUTO_START_THREAD
    bool "Auto-start Zmod IWDOG feed thread"
    default y
    depends on ZMOD_IWDOG
    help
      Automatically start the watchdog feeding thread during initialization.
      If disabled, the application must manually call zmod_iwdog_start_service_thread().

config ZMOD_IWDOG_ZBUS_PUBLISH
    bool "Publish imminent-reset warnings via Zbus"
    default y
    depends on ZMOD_IWDOG && ZBUS
    help
      Publish watchdog reset imminent warnings to Zbus channel.
      Allows other modules to subscribe to watchdog warning events.

config ZMOD_IWDOG_LOG_PANIC_ON_WARNING
    bool "Force immediate log flush on watchdog warning"
    default n
    depends on ZMOD_IWDOG
    help
      Calls LOG_PANIC() shortly before reset to flush logs. Increases latency.

config ZMOD_IWDOG_LOG_PANIC_THRESHOLD_MS
    int "Threshold before reset to call LOG_PANIC"
    default 250
    range 0 5000
    depends on ZMOD_IWDOG_LOG_PANIC_ON_WARNING
    help
      Milliseconds before watchdog reset to call LOG_PANIC().
      LOG_PANIC() forces synchronous log output to ensure messages are flushed.


# Pattern for per-module logging config
module = ZMOD_IWDOG
module-str = ZMOD_IWDOG
source "subsys/logging/Kconfig.template.log_config"


endmenu